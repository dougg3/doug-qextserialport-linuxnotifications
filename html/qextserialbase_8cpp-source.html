<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>QextSerialPort: qextserialbase.cpp Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.3.6 -->
<div class="qindex"><a class="qindex" href="index.html">Main&nbsp;Page</a> | <a class="qindex" href="hierarchy.html">Class&nbsp;Hierarchy</a> | <a class="qindex" href="annotated.html">Class&nbsp;List</a> | <a class="qindex" href="files.html">File&nbsp;List</a> | <a class="qindex" href="functions.html">Class&nbsp;Members</a></div>
<h1>qextserialbase.cpp</h1><div class="fragment"><pre>00001 
00002 <span class="preprocessor">#include "qextserialbase.h"</span>
00003 
00011 <span class="preprocessor">#ifdef QT_THREAD_SUPPORT</span>
00012 <span class="preprocessor"></span>QMutex* QextSerialBase::mutex=NULL;
00013 <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> QextSerialBase::refCount=0;
00014 <span class="preprocessor">#endif</span>
00015 <span class="preprocessor"></span>
<a name="l00020"></a><a class="code" href="classQextSerialBase.html#a0">00020</a> <a class="code" href="classQextSerialBase.html#a0">QextSerialBase::QextSerialBase</a>()
00021  : QIODevice()
00022 {
00023 
00024 <span class="preprocessor">#ifdef _TTY_WIN_</span>
00025 <span class="preprocessor"></span>    <a class="code" href="classQextSerialBase.html#a4">setPortName</a>(<span class="stringliteral">"COM1"</span>);
00026 
00027 <span class="preprocessor">#elif defined(_TTY_IRIX_)</span>
00028 <span class="preprocessor"></span>    <a class="code" href="classQextSerialBase.html#a4">setPortName</a>(<span class="stringliteral">"/dev/ttyf1"</span>);
00029 
00030 <span class="preprocessor">#elif defined(_TTY_HPUX_)</span>
00031 <span class="preprocessor"></span>    <a class="code" href="classQextSerialBase.html#a4">setPortName</a>(<span class="stringliteral">"/dev/tty1p0"</span>);
00032 
00033 <span class="preprocessor">#elif defined(_TTY_SUN_)</span>
00034 <span class="preprocessor"></span>    <a class="code" href="classQextSerialBase.html#a4">setPortName</a>(<span class="stringliteral">"/dev/ttya"</span>);
00035 
00036 <span class="preprocessor">#elif defined(_TTY_DIGITAL_)</span>
00037 <span class="preprocessor"></span>    <a class="code" href="classQextSerialBase.html#a4">setPortName</a>(<span class="stringliteral">"/dev/tty01"</span>);
00038 
00039 <span class="preprocessor">#elif defined(_TTY_FREEBSD_)</span>
00040 <span class="preprocessor"></span>    <a class="code" href="classQextSerialBase.html#a4">setPortName</a>(<span class="stringliteral">"/dev/ttyd1"</span>);
00041 
00042 <span class="preprocessor">#else</span>
00043 <span class="preprocessor"></span>    <a class="code" href="classQextSerialBase.html#a4">setPortName</a>(<span class="stringliteral">"/dev/ttyS0"</span>);
00044 <span class="preprocessor">#endif</span>
00045 <span class="preprocessor"></span>
00046     <a class="code" href="classQextSerialBase.html#a3">construct</a>();
00047 }
00048 
<a name="l00053"></a><a class="code" href="classQextSerialBase.html#a1">00053</a> <a class="code" href="classQextSerialBase.html#a0">QextSerialBase::QextSerialBase</a>(<span class="keyword">const</span> QString &amp; name)
00054  : QIODevice()
00055 {
00056     <a class="code" href="classQextSerialBase.html#a4">setPortName</a>(name);
00057     <a class="code" href="classQextSerialBase.html#a3">construct</a>();
00058 }
00059 
<a name="l00064"></a><a class="code" href="classQextSerialBase.html#a2">00064</a> <a class="code" href="classQextSerialBase.html#a2">QextSerialBase::~QextSerialBase</a>()
00065 {
00066 
00067 <span class="preprocessor">#ifdef QT_THREAD_SUPPORT</span>
00068 <span class="preprocessor"></span>    refCount--;
00069     <span class="keywordflow">if</span> (mutex &amp;&amp; refCount==0) {
00070         <span class="keyword">delete</span> mutex;
00071         mutex=NULL;
00072     }
00073 <span class="preprocessor">#endif</span>
00074 <span class="preprocessor"></span>
00075 }
00076 
<a name="l00082"></a><a class="code" href="classQextSerialBase.html#a3">00082</a> <span class="keywordtype">void</span> <a class="code" href="classQextSerialBase.html#a3">QextSerialBase::construct</a>()
00083 {
00084     Settings.BaudRate=BAUD115200;
00085     Settings.DataBits=DATA_8;
00086     Settings.Parity=PAR_NONE;
00087     Settings.StopBits=STOP_1;
00088     Settings.FlowControl=FLOW_HARDWARE;
00089     Settings.Timeout_Sec=0;
00090     Settings.Timeout_Millisec=500;
00091 
00092 <span class="preprocessor">#ifdef QT_THREAD_SUPPORT</span>
00093 <span class="preprocessor"></span>    <span class="keywordflow">if</span> (!mutex) {
00094         mutex=<span class="keyword">new</span> QMutex(TRUE);
00095     }
00096     refCount++;
00097 <span class="preprocessor">#endif</span>
00098 <span class="preprocessor"></span>
00099     portOpen=<span class="keyword">false</span>;
00100 }
00101 
<a name="l00106"></a><a class="code" href="classQextSerialBase.html#a4">00106</a> <span class="keywordtype">void</span> <a class="code" href="classQextSerialBase.html#a4">QextSerialBase::setPortName</a>(<span class="keyword">const</span> QString &amp; name)
00107 {
00108     port = name;
00109 }
00110 
<a name="l00115"></a><a class="code" href="classQextSerialBase.html#a5">00115</a> QString <a class="code" href="classQextSerialBase.html#a5">QextSerialBase::portName</a>()<span class="keyword"> const</span>
00116 <span class="keyword"></span>{
00117     <span class="keywordflow">return</span> port;
00118 }
00119 
<a name="l00125"></a><a class="code" href="classQextSerialBase.html#a7">00125</a> BaudRateType <a class="code" href="classQextSerialBase.html#a7">QextSerialBase::baudRate</a>(<span class="keywordtype">void</span>)<span class="keyword"> const</span>
00126 <span class="keyword"></span>{
00127     <span class="keywordflow">return</span> Settings.BaudRate;
00128 }
00129 
<a name="l00135"></a><a class="code" href="classQextSerialBase.html#a9">00135</a> DataBitsType <a class="code" href="classQextSerialBase.html#a9">QextSerialBase::dataBits</a>()<span class="keyword"> const</span>
00136 <span class="keyword"></span>{
00137     <span class="keywordflow">return</span> Settings.DataBits;
00138 }
00139 
<a name="l00145"></a><a class="code" href="classQextSerialBase.html#a11">00145</a> ParityType <a class="code" href="classQextSerialBase.html#a11">QextSerialBase::parity</a>()<span class="keyword"> const</span>
00146 <span class="keyword"></span>{
00147     <span class="keywordflow">return</span> Settings.Parity;
00148 }
00149 
<a name="l00155"></a><a class="code" href="classQextSerialBase.html#a13">00155</a> StopBitsType <a class="code" href="classQextSerialBase.html#a13">QextSerialBase::stopBits</a>()<span class="keyword"> const</span>
00156 <span class="keyword"></span>{
00157     <span class="keywordflow">return</span> Settings.StopBits;
00158 }
00159 
<a name="l00165"></a><a class="code" href="classQextSerialBase.html#a15">00165</a> FlowType <a class="code" href="classQextSerialBase.html#a15">QextSerialBase::flowControl</a>()<span class="keyword"> const</span>
00166 <span class="keyword"></span>{
00167     <span class="keywordflow">return</span> Settings.FlowControl;
00168 }
00169 
<a name="l00174"></a><a class="code" href="classQextSerialBase.html#a18">00174</a> <span class="keywordtype">bool</span> <a class="code" href="classQextSerialBase.html#a18">QextSerialBase::isOpen</a>()<span class="keyword"> const</span>
00175 <span class="keyword"></span>{
00176     <span class="keywordflow">return</span> portOpen;
00177 }
00178 
<a name="l00184"></a><a class="code" href="classQextSerialBase.html#a23">00184</a> <span class="keywordtype">bool</span> <a class="code" href="classQextSerialBase.html#a23">QextSerialBase::atEnd</a>()<span class="keyword"> const</span>
00185 <span class="keyword"></span>{
00186     <span class="keywordflow">if</span> (size()) {
00187         <span class="keywordflow">return</span> <span class="keyword">true</span>;
00188     }
00189     <span class="keywordflow">return</span> <span class="keyword">false</span>;
00190 }
00191 
<a name="l00198"></a><a class="code" href="classQextSerialBase.html#a27">00198</a> qint64 <a class="code" href="classQextSerialBase.html#a27">QextSerialBase::readLine</a>(<span class="keywordtype">char</span> * data, qint64 maxSize)
00199 {
00200     qint64 numBytes = bytesAvailable();
00201     <span class="keywordtype">char</span>* pData = data;
00202 
00203     <span class="comment">/*if nothing waiting, return 0 length*/</span>
00204     <span class="keywordflow">if</span> (numBytes&lt;1) {
00205         <span class="keywordflow">return</span> 0;
00206     }
00207 
00208     <span class="comment">/*read a byte at a time for MIN(bytesAvail, maxSize) iterations, or until a newline*/</span>
00209     <span class="keywordflow">while</span> (pData&lt;(data+numBytes) &amp;&amp; --maxSize) {
00210         readData(pData, 1);
00211         <span class="keywordflow">if</span> (*pData++ == <span class="charliteral">'\n'</span>) {
00212             <span class="keywordflow">break</span>;
00213         }
00214     }
00215     *pData++=<span class="charliteral">'\0'</span>;
00216 
00217     <span class="comment">/*return size of data read*/</span>
00218     <span class="keywordflow">return</span> (pData-data);
00219 }
00220 
<a name="l00247"></a><a class="code" href="classQextSerialBase.html#a28">00247</a> ulong <a class="code" href="classQextSerialBase.html#a28">QextSerialBase::lastError</a>()<span class="keyword"> const</span>
00248 <span class="keyword"></span>{
00249     <span class="keywordflow">return</span> lastErr;
00250 }
</pre></div><hr size="1"><address style="align: right;"><small>Generated on Sat Jul 9 11:14:24 2005 for QextSerialPort by
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border=0 > </a>1.3.6 </small></address>
</body>
</html>
