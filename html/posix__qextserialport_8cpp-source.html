<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>QextSerialPort: posix_qextserialport.cpp Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.3.6 -->
<div class="qindex"><a class="qindex" href="index.html">Main&nbsp;Page</a> | <a class="qindex" href="hierarchy.html">Class&nbsp;Hierarchy</a> | <a class="qindex" href="annotated.html">Class&nbsp;List</a> | <a class="qindex" href="files.html">File&nbsp;List</a> | <a class="qindex" href="functions.html">Class&nbsp;Members</a></div>
<h1>posix_qextserialport.cpp</h1><div class="fragment"><pre>00001 
00014 <span class="preprocessor">#include &lt;stdio.h&gt;</span>
00015 <span class="preprocessor">#include "posix_qextserialport.h"</span>
00016 
<a name="l00040"></a><a class="code" href="classPosix__QextSerialPort.html#a0">00040</a> <a class="code" href="classPosix__QextSerialPort.html#a0">Posix_QextSerialPort::Posix_QextSerialPort</a>()
00041 : <a class="code" href="classQextSerialBase.html">QextSerialBase</a>()
00042 {
00043     Posix_File=<span class="keyword">new</span> QFile();
00044 }
00045 
<a name="l00050"></a><a class="code" href="classPosix__QextSerialPort.html#a1">00050</a> <a class="code" href="classPosix__QextSerialPort.html#a0">Posix_QextSerialPort::Posix_QextSerialPort</a>(<span class="keyword">const</span> <a class="code" href="classPosix__QextSerialPort.html">Posix_QextSerialPort</a>&amp; s)
00051  : <a class="code" href="classQextSerialBase.html">QextSerialBase</a>(s.port)
00052 {
00053     port = s.<a class="code" href="classQextSerialBase.html#p0">port</a>;
00054     portOpen=s.<a class="code" href="classQextSerialBase.html#p1">portOpen</a>;
00055     Settings.BaudRate=s.<a class="code" href="classQextSerialBase.html#p2">Settings</a>.BaudRate;
00056     Settings.DataBits=s.<a class="code" href="classQextSerialBase.html#p2">Settings</a>.DataBits;
00057     Settings.Parity=s.<a class="code" href="classQextSerialBase.html#p2">Settings</a>.Parity;
00058     Settings.StopBits=s.<a class="code" href="classQextSerialBase.html#p2">Settings</a>.StopBits;
00059     Settings.FlowControl=s.<a class="code" href="classQextSerialBase.html#p2">Settings</a>.FlowControl;
00060     lastErr=s.<a class="code" href="classQextSerialBase.html#p3">lastErr</a>;
00061 
00062     Posix_File=<span class="keyword">new</span> QFile();
00063     Posix_File=s.<a class="code" href="classPosix__QextSerialPort.html#p0">Posix_File</a>;
00064     memcpy(&amp;Posix_Timeout, &amp;s.<a class="code" href="classPosix__QextSerialPort.html#p2">Posix_Timeout</a>, <span class="keyword">sizeof</span>(<span class="keyword">struct</span> timeval));
00065     memcpy(&amp;Posix_Copy_Timeout, &amp;s.<a class="code" href="classPosix__QextSerialPort.html#p3">Posix_Copy_Timeout</a>, <span class="keyword">sizeof</span>(<span class="keyword">struct</span> timeval));
00066     memcpy(&amp;Posix_CommConfig, &amp;s.<a class="code" href="classPosix__QextSerialPort.html#p1">Posix_CommConfig</a>, <span class="keyword">sizeof</span>(<span class="keyword">struct</span> termios));
00067 }
00068 
<a name="l00075"></a><a class="code" href="classPosix__QextSerialPort.html#a2">00075</a> <a class="code" href="classPosix__QextSerialPort.html#a0">Posix_QextSerialPort::Posix_QextSerialPort</a>(<span class="keyword">const</span> QString &amp; name)
00076  : <a class="code" href="classQextSerialBase.html">QextSerialBase</a>(name)
00077 {
00078     Posix_File=<span class="keyword">new</span> QFile();
00079 }
00080 
<a name="l00085"></a><a class="code" href="classPosix__QextSerialPort.html#a3">00085</a> <a class="code" href="classPosix__QextSerialPort.html#a0">Posix_QextSerialPort::Posix_QextSerialPort</a>(<span class="keyword">const</span> PortSettings&amp; settings)
00086  : <a class="code" href="classQextSerialBase.html">QextSerialBase</a>()
00087 {
00088     <a class="code" href="classPosix__QextSerialPort.html#a7">setBaudRate</a>(settings.BaudRate);
00089     <a class="code" href="classPosix__QextSerialPort.html#a8">setDataBits</a>(settings.DataBits);
00090     <a class="code" href="classPosix__QextSerialPort.html#a9">setParity</a>(settings.Parity);
00091     <a class="code" href="classPosix__QextSerialPort.html#a10">setStopBits</a>(settings.StopBits);
00092     setFlowControl(settings.FlowControl);
00093 
00094     Posix_File=<span class="keyword">new</span> QFile();
00095     setTimeout(settings.Timeout_Sec, settings.Timeout_Millisec);
00096 }
00097 
00102 <a class="code" href="classPosix__QextSerialPort.html#a0">Posix_QextSerialPort::Posix_QextSerialPort</a>(<span class="keyword">const</span> QString &amp; name, <span class="keyword">const</span> PortSettings&amp; settings)
00103  : <a class="code" href="classQextSerialBase.html">QextSerialBase</a>(name)
00104 {
00105     <a class="code" href="classPosix__QextSerialPort.html#a7">setBaudRate</a>(settings.BaudRate);
00106     <a class="code" href="classPosix__QextSerialPort.html#a8">setDataBits</a>(settings.DataBits);
00107     <a class="code" href="classPosix__QextSerialPort.html#a9">setParity</a>(settings.Parity);
00108     <a class="code" href="classPosix__QextSerialPort.html#a10">setStopBits</a>(settings.StopBits);
00109     setFlowControl(settings.FlowControl);
00110 
00111     Posix_File=<span class="keyword">new</span> QFile();
00112     setTimeout(settings.Timeout_Sec, settings.Timeout_Millisec);
00113 }
00114 
<a name="l00119"></a><a class="code" href="classPosix__QextSerialPort.html#a5">00119</a> <a class="code" href="classPosix__QextSerialPort.html">Posix_QextSerialPort</a>&amp; <a class="code" href="classPosix__QextSerialPort.html#a5">Posix_QextSerialPort::operator=</a>(<span class="keyword">const</span> <a class="code" href="classPosix__QextSerialPort.html">Posix_QextSerialPort</a>&amp; s)
00120 {
00121     port = s.<a class="code" href="classQextSerialBase.html#p0">port</a>;
00122     portOpen=s.<a class="code" href="classQextSerialBase.html#p1">portOpen</a>;
00123     Settings.BaudRate=s.<a class="code" href="classQextSerialBase.html#p2">Settings</a>.BaudRate;
00124     Settings.DataBits=s.<a class="code" href="classQextSerialBase.html#p2">Settings</a>.DataBits;
00125     Settings.Parity=s.<a class="code" href="classQextSerialBase.html#p2">Settings</a>.Parity;
00126     Settings.StopBits=s.<a class="code" href="classQextSerialBase.html#p2">Settings</a>.StopBits;
00127     Settings.FlowControl=s.<a class="code" href="classQextSerialBase.html#p2">Settings</a>.FlowControl;
00128     lastErr=s.<a class="code" href="classQextSerialBase.html#p3">lastErr</a>;
00129 
00130     Posix_File=s.<a class="code" href="classPosix__QextSerialPort.html#p0">Posix_File</a>;
00131     memcpy(&amp;Posix_Timeout, &amp;(s.<a class="code" href="classPosix__QextSerialPort.html#p2">Posix_Timeout</a>), <span class="keyword">sizeof</span>(<span class="keyword">struct</span> timeval));
00132     memcpy(&amp;Posix_Copy_Timeout, &amp;(s.<a class="code" href="classPosix__QextSerialPort.html#p3">Posix_Copy_Timeout</a>), <span class="keyword">sizeof</span>(<span class="keyword">struct</span> timeval));
00133     memcpy(&amp;Posix_CommConfig, &amp;(s.<a class="code" href="classPosix__QextSerialPort.html#p1">Posix_CommConfig</a>), <span class="keyword">sizeof</span>(<span class="keyword">struct</span> termios));
00134     <span class="keywordflow">return</span> *<span class="keyword">this</span>;
00135 }
00136 
<a name="l00141"></a><a class="code" href="classPosix__QextSerialPort.html#a6">00141</a> <a class="code" href="classPosix__QextSerialPort.html#a6">Posix_QextSerialPort::~Posix_QextSerialPort</a>()
00142 {
00143     <span class="keywordflow">if</span> (portOpen) {
00144         <a class="code" href="classPosix__QextSerialPort.html#a14">close</a>();
00145     }
00146     Posix_File-&gt;close();
00147     <span class="keyword">delete</span> Posix_File;
00148 }
00149 
<a name="l00189"></a><a class="code" href="classPosix__QextSerialPort.html#a7">00189</a> <span class="keywordtype">void</span> <a class="code" href="classPosix__QextSerialPort.html#a7">Posix_QextSerialPort::setBaudRate</a>(BaudRateType baudRate)
00190 {
00191     LOCK_MUTEX();
00192     <span class="keywordflow">if</span> (Settings.BaudRate!=baudRate) {
00193         <span class="keywordflow">switch</span> (baudRate) {
00194             <span class="keywordflow">case</span> BAUD14400:
00195                 Settings.BaudRate=BAUD9600;
00196                 <span class="keywordflow">break</span>;
00197 
00198             <span class="keywordflow">case</span> BAUD56000:
00199                 Settings.BaudRate=BAUD38400;
00200                 <span class="keywordflow">break</span>;
00201 
00202             <span class="keywordflow">case</span> BAUD76800:
00203 
00204 <span class="preprocessor">#ifndef B76800</span>
00205 <span class="preprocessor"></span>                Settings.BaudRate=BAUD57600;
00206 <span class="preprocessor">#else</span>
00207 <span class="preprocessor"></span>                Settings.BaudRate=baudRate;
00208 <span class="preprocessor">#endif</span>
00209 <span class="preprocessor"></span>                <span class="keywordflow">break</span>;
00210 
00211             <span class="keywordflow">case</span> BAUD128000:
00212             <span class="keywordflow">case</span> BAUD256000:
00213                 Settings.BaudRate=BAUD115200;
00214                 <span class="keywordflow">break</span>;
00215 
00216             <span class="keywordflow">default</span>:
00217                 Settings.BaudRate=baudRate;
00218                 <span class="keywordflow">break</span>;
00219         }
00220     }
00221     <span class="keywordflow">if</span> (portOpen) {
00222         <span class="keywordflow">switch</span> (baudRate) {
00223 
00224             <span class="comment">/*50 baud*/</span>
00225             <span class="keywordflow">case</span> BAUD50:
00226                 TTY_PORTABILITY_WARNING(<span class="stringliteral">"Posix_QextSerialPort Portability Warning: Windows does not support 50 baud operation."</span>);
00227 <span class="preprocessor">#ifdef CBAUD</span>
00228 <span class="preprocessor"></span>                Posix_CommConfig.c_cflag&amp;=(~CBAUD);
00229                 Posix_CommConfig.c_cflag|=B50;
00230 <span class="preprocessor">#else</span>
00231 <span class="preprocessor"></span>                cfsetispeed(&amp;Posix_CommConfig, B50);
00232                 cfsetospeed(&amp;Posix_CommConfig, B50);
00233 <span class="preprocessor">#endif</span>
00234 <span class="preprocessor"></span>                <span class="keywordflow">break</span>;
00235 
00236             <span class="comment">/*75 baud*/</span>
00237             <span class="keywordflow">case</span> BAUD75:
00238                 TTY_PORTABILITY_WARNING(<span class="stringliteral">"Posix_QextSerialPort Portability Warning: Windows does not support 75 baud operation."</span>);
00239 <span class="preprocessor">#ifdef CBAUD</span>
00240 <span class="preprocessor"></span>                Posix_CommConfig.c_cflag&amp;=(~CBAUD);
00241                 Posix_CommConfig.c_cflag|=B75;
00242 <span class="preprocessor">#else</span>
00243 <span class="preprocessor"></span>                cfsetispeed(&amp;Posix_CommConfig, B75);
00244                 cfsetospeed(&amp;Posix_CommConfig, B75);
00245 <span class="preprocessor">#endif</span>
00246 <span class="preprocessor"></span>                <span class="keywordflow">break</span>;
00247 
00248             <span class="comment">/*110 baud*/</span>
00249             <span class="keywordflow">case</span> BAUD110:
00250 <span class="preprocessor">#ifdef CBAUD</span>
00251 <span class="preprocessor"></span>                Posix_CommConfig.c_cflag&amp;=(~CBAUD);
00252                 Posix_CommConfig.c_cflag|=B110;
00253 <span class="preprocessor">#else</span>
00254 <span class="preprocessor"></span>                cfsetispeed(&amp;Posix_CommConfig, B110);
00255                 cfsetospeed(&amp;Posix_CommConfig, B110);
00256 <span class="preprocessor">#endif</span>
00257 <span class="preprocessor"></span>                <span class="keywordflow">break</span>;
00258 
00259             <span class="comment">/*134.5 baud*/</span>
00260             <span class="keywordflow">case</span> BAUD134:
00261                 TTY_PORTABILITY_WARNING(<span class="stringliteral">"Posix_QextSerialPort Portability Warning: Windows does not support 134.5 baud operation."</span>);
00262 <span class="preprocessor">#ifdef CBAUD</span>
00263 <span class="preprocessor"></span>                Posix_CommConfig.c_cflag&amp;=(~CBAUD);
00264                 Posix_CommConfig.c_cflag|=B134;
00265 <span class="preprocessor">#else</span>
00266 <span class="preprocessor"></span>                cfsetispeed(&amp;Posix_CommConfig, B134);
00267                 cfsetospeed(&amp;Posix_CommConfig, B134);
00268 <span class="preprocessor">#endif</span>
00269 <span class="preprocessor"></span>                <span class="keywordflow">break</span>;
00270 
00271             <span class="comment">/*150 baud*/</span>
00272             <span class="keywordflow">case</span> BAUD150:
00273                 TTY_PORTABILITY_WARNING(<span class="stringliteral">"Posix_QextSerialPort Portability Warning: Windows does not support 150 baud operation."</span>);
00274 <span class="preprocessor">#ifdef CBAUD</span>
00275 <span class="preprocessor"></span>                Posix_CommConfig.c_cflag&amp;=(~CBAUD);
00276                 Posix_CommConfig.c_cflag|=B150;
00277 <span class="preprocessor">#else</span>
00278 <span class="preprocessor"></span>                cfsetispeed(&amp;Posix_CommConfig, B150);
00279                 cfsetospeed(&amp;Posix_CommConfig, B150);
00280 <span class="preprocessor">#endif</span>
00281 <span class="preprocessor"></span>                <span class="keywordflow">break</span>;
00282 
00283             <span class="comment">/*200 baud*/</span>
00284             <span class="keywordflow">case</span> BAUD200:
00285                 TTY_PORTABILITY_WARNING(<span class="stringliteral">"Posix_QextSerialPort Portability Warning: Windows does not support 200 baud operation."</span>);
00286 <span class="preprocessor">#ifdef CBAUD</span>
00287 <span class="preprocessor"></span>                Posix_CommConfig.c_cflag&amp;=(~CBAUD);
00288                 Posix_CommConfig.c_cflag|=B200;
00289 <span class="preprocessor">#else</span>
00290 <span class="preprocessor"></span>                cfsetispeed(&amp;Posix_CommConfig, B200);
00291                 cfsetospeed(&amp;Posix_CommConfig, B200);
00292 <span class="preprocessor">#endif</span>
00293 <span class="preprocessor"></span>                <span class="keywordflow">break</span>;
00294 
00295             <span class="comment">/*300 baud*/</span>
00296             <span class="keywordflow">case</span> BAUD300:
00297 <span class="preprocessor">#ifdef CBAUD</span>
00298 <span class="preprocessor"></span>                Posix_CommConfig.c_cflag&amp;=(~CBAUD);
00299                 Posix_CommConfig.c_cflag|=B300;
00300 <span class="preprocessor">#else</span>
00301 <span class="preprocessor"></span>                cfsetispeed(&amp;Posix_CommConfig, B300);
00302                 cfsetospeed(&amp;Posix_CommConfig, B300);
00303 <span class="preprocessor">#endif</span>
00304 <span class="preprocessor"></span>                <span class="keywordflow">break</span>;
00305 
00306             <span class="comment">/*600 baud*/</span>
00307             <span class="keywordflow">case</span> BAUD600:
00308 <span class="preprocessor">#ifdef CBAUD</span>
00309 <span class="preprocessor"></span>                Posix_CommConfig.c_cflag&amp;=(~CBAUD);
00310                 Posix_CommConfig.c_cflag|=B600;
00311 <span class="preprocessor">#else</span>
00312 <span class="preprocessor"></span>                cfsetispeed(&amp;Posix_CommConfig, B600);
00313                 cfsetospeed(&amp;Posix_CommConfig, B600);
00314 <span class="preprocessor">#endif</span>
00315 <span class="preprocessor"></span>                <span class="keywordflow">break</span>;
00316 
00317             <span class="comment">/*1200 baud*/</span>
00318             <span class="keywordflow">case</span> BAUD1200:
00319 <span class="preprocessor">#ifdef CBAUD</span>
00320 <span class="preprocessor"></span>                Posix_CommConfig.c_cflag&amp;=(~CBAUD);
00321                 Posix_CommConfig.c_cflag|=B1200;
00322 <span class="preprocessor">#else</span>
00323 <span class="preprocessor"></span>                cfsetispeed(&amp;Posix_CommConfig, B1200);
00324                 cfsetospeed(&amp;Posix_CommConfig, B1200);
00325 <span class="preprocessor">#endif</span>
00326 <span class="preprocessor"></span>                <span class="keywordflow">break</span>;
00327 
00328             <span class="comment">/*1800 baud*/</span>
00329             <span class="keywordflow">case</span> BAUD1800:
00330                 TTY_PORTABILITY_WARNING(<span class="stringliteral">"Posix_QextSerialPort Portability Warning: Windows and IRIX do not support 1800 baud operation."</span>);
00331 <span class="preprocessor">#ifdef CBAUD</span>
00332 <span class="preprocessor"></span>                Posix_CommConfig.c_cflag&amp;=(~CBAUD);
00333                 Posix_CommConfig.c_cflag|=B1800;
00334 <span class="preprocessor">#else</span>
00335 <span class="preprocessor"></span>                cfsetispeed(&amp;Posix_CommConfig, B1800);
00336                 cfsetospeed(&amp;Posix_CommConfig, B1800);
00337 <span class="preprocessor">#endif</span>
00338 <span class="preprocessor"></span>                <span class="keywordflow">break</span>;
00339 
00340             <span class="comment">/*2400 baud*/</span>
00341             <span class="keywordflow">case</span> BAUD2400:
00342 <span class="preprocessor">#ifdef CBAUD</span>
00343 <span class="preprocessor"></span>                Posix_CommConfig.c_cflag&amp;=(~CBAUD);
00344                 Posix_CommConfig.c_cflag|=B2400;
00345 <span class="preprocessor">#else</span>
00346 <span class="preprocessor"></span>                cfsetispeed(&amp;Posix_CommConfig, B2400);
00347                 cfsetospeed(&amp;Posix_CommConfig, B2400);
00348 <span class="preprocessor">#endif</span>
00349 <span class="preprocessor"></span>                <span class="keywordflow">break</span>;
00350 
00351             <span class="comment">/*4800 baud*/</span>
00352             <span class="keywordflow">case</span> BAUD4800:
00353 <span class="preprocessor">#ifdef CBAUD</span>
00354 <span class="preprocessor"></span>                Posix_CommConfig.c_cflag&amp;=(~CBAUD);
00355                 Posix_CommConfig.c_cflag|=B4800;
00356 <span class="preprocessor">#else</span>
00357 <span class="preprocessor"></span>                cfsetispeed(&amp;Posix_CommConfig, B4800);
00358                 cfsetospeed(&amp;Posix_CommConfig, B4800);
00359 <span class="preprocessor">#endif</span>
00360 <span class="preprocessor"></span>                <span class="keywordflow">break</span>;
00361 
00362             <span class="comment">/*9600 baud*/</span>
00363             <span class="keywordflow">case</span> BAUD9600:
00364 <span class="preprocessor">#ifdef CBAUD</span>
00365 <span class="preprocessor"></span>                Posix_CommConfig.c_cflag&amp;=(~CBAUD);
00366                 Posix_CommConfig.c_cflag|=B9600;
00367 <span class="preprocessor">#else</span>
00368 <span class="preprocessor"></span>                cfsetispeed(&amp;Posix_CommConfig, B9600);
00369                 cfsetospeed(&amp;Posix_CommConfig, B9600);
00370 <span class="preprocessor">#endif</span>
00371 <span class="preprocessor"></span>                <span class="keywordflow">break</span>;
00372 
00373             <span class="comment">/*14400 baud*/</span>
00374             <span class="keywordflow">case</span> BAUD14400:
00375                 TTY_WARNING(<span class="stringliteral">"Posix_QextSerialPort: POSIX does not support 14400 baud operation.  Switching to 9600 baud."</span>);
00376 <span class="preprocessor">#ifdef CBAUD</span>
00377 <span class="preprocessor"></span>                Posix_CommConfig.c_cflag&amp;=(~CBAUD);
00378                 Posix_CommConfig.c_cflag|=B9600;
00379 <span class="preprocessor">#else</span>
00380 <span class="preprocessor"></span>                cfsetispeed(&amp;Posix_CommConfig, B9600);
00381                 cfsetospeed(&amp;Posix_CommConfig, B9600);
00382 <span class="preprocessor">#endif</span>
00383 <span class="preprocessor"></span>                <span class="keywordflow">break</span>;
00384 
00385             <span class="comment">/*19200 baud*/</span>
00386             <span class="keywordflow">case</span> BAUD19200:
00387 <span class="preprocessor">#ifdef CBAUD</span>
00388 <span class="preprocessor"></span>                Posix_CommConfig.c_cflag&amp;=(~CBAUD);
00389                 Posix_CommConfig.c_cflag|=B19200;
00390 <span class="preprocessor">#else</span>
00391 <span class="preprocessor"></span>                cfsetispeed(&amp;Posix_CommConfig, B19200);
00392                 cfsetospeed(&amp;Posix_CommConfig, B19200);
00393 <span class="preprocessor">#endif</span>
00394 <span class="preprocessor"></span>                <span class="keywordflow">break</span>;
00395 
00396             <span class="comment">/*38400 baud*/</span>
00397             <span class="keywordflow">case</span> BAUD38400:
00398 <span class="preprocessor">#ifdef CBAUD</span>
00399 <span class="preprocessor"></span>                Posix_CommConfig.c_cflag&amp;=(~CBAUD);
00400                 Posix_CommConfig.c_cflag|=B38400;
00401 <span class="preprocessor">#else</span>
00402 <span class="preprocessor"></span>                cfsetispeed(&amp;Posix_CommConfig, B38400);
00403                 cfsetospeed(&amp;Posix_CommConfig, B38400);
00404 <span class="preprocessor">#endif</span>
00405 <span class="preprocessor"></span>                <span class="keywordflow">break</span>;
00406 
00407             <span class="comment">/*56000 baud*/</span>
00408             <span class="keywordflow">case</span> BAUD56000:
00409                 TTY_WARNING(<span class="stringliteral">"Posix_QextSerialPort: POSIX does not support 56000 baud operation.  Switching to 38400 baud."</span>);
00410 <span class="preprocessor">#ifdef CBAUD</span>
00411 <span class="preprocessor"></span>                Posix_CommConfig.c_cflag&amp;=(~CBAUD);
00412                 Posix_CommConfig.c_cflag|=B38400;
00413 <span class="preprocessor">#else</span>
00414 <span class="preprocessor"></span>                cfsetispeed(&amp;Posix_CommConfig, B38400);
00415                 cfsetospeed(&amp;Posix_CommConfig, B38400);
00416 <span class="preprocessor">#endif</span>
00417 <span class="preprocessor"></span>                <span class="keywordflow">break</span>;
00418 
00419             <span class="comment">/*57600 baud*/</span>
00420             <span class="keywordflow">case</span> BAUD57600:
00421 <span class="preprocessor">#ifdef CBAUD</span>
00422 <span class="preprocessor"></span>                Posix_CommConfig.c_cflag&amp;=(~CBAUD);
00423                 Posix_CommConfig.c_cflag|=B57600;
00424 <span class="preprocessor">#else</span>
00425 <span class="preprocessor"></span>                cfsetispeed(&amp;Posix_CommConfig, B57600);
00426                 cfsetospeed(&amp;Posix_CommConfig, B57600);
00427 <span class="preprocessor">#endif</span>
00428 <span class="preprocessor"></span>                <span class="keywordflow">break</span>;
00429 
00430             <span class="comment">/*76800 baud*/</span>
00431             <span class="keywordflow">case</span> BAUD76800:
00432                 TTY_PORTABILITY_WARNING(<span class="stringliteral">"Posix_QextSerialPort Portability Warning: Windows and some POSIX systems do not support 76800 baud operation."</span>);
00433 <span class="preprocessor">#ifdef CBAUD</span>
00434 <span class="preprocessor"></span>                Posix_CommConfig.c_cflag&amp;=(~CBAUD);
00435 
00436 <span class="preprocessor">#ifdef B76800</span>
00437 <span class="preprocessor"></span>                Posix_CommConfig.c_cflag|=B76800;
00438 <span class="preprocessor">#else</span>
00439 <span class="preprocessor"></span>                TTY_WARNING(<span class="stringliteral">"Posix_QextSerialPort: Posix_QextSerialPort was compiled without 76800 baud support.  Switching to 57600 baud."</span>);
00440                 Posix_CommConfig.c_cflag|=B57600;
00441 <span class="preprocessor">#endif //B76800</span>
00442 <span class="preprocessor"></span><span class="preprocessor">#else  //CBAUD</span>
00443 <span class="preprocessor"></span><span class="preprocessor">#ifdef B76800</span>
00444 <span class="preprocessor"></span>                cfsetispeed(&amp;Posix_CommConfig, B76800);
00445                 cfsetospeed(&amp;Posix_CommConfig, B76800);
00446 <span class="preprocessor">#else</span>
00447 <span class="preprocessor"></span>                TTY_WARNING(<span class="stringliteral">"Posix_QextSerialPort: Posix_QextSerialPort was compiled without 76800 baud support.  Switching to 57600 baud."</span>);
00448                 cfsetispeed(&amp;Posix_CommConfig, B57600);
00449                 cfsetospeed(&amp;Posix_CommConfig, B57600);
00450 <span class="preprocessor">#endif //B76800</span>
00451 <span class="preprocessor"></span><span class="preprocessor">#endif //CBAUD</span>
00452 <span class="preprocessor"></span>                <span class="keywordflow">break</span>;
00453 
00454             <span class="comment">/*115200 baud*/</span>
00455             <span class="keywordflow">case</span> BAUD115200:
00456 <span class="preprocessor">#ifdef CBAUD</span>
00457 <span class="preprocessor"></span>                Posix_CommConfig.c_cflag&amp;=(~CBAUD);
00458                 Posix_CommConfig.c_cflag|=B115200;
00459 <span class="preprocessor">#else</span>
00460 <span class="preprocessor"></span>                cfsetispeed(&amp;Posix_CommConfig, B115200);
00461                 cfsetospeed(&amp;Posix_CommConfig, B115200);
00462 <span class="preprocessor">#endif</span>
00463 <span class="preprocessor"></span>                <span class="keywordflow">break</span>;
00464 
00465             <span class="comment">/*128000 baud*/</span>
00466             <span class="keywordflow">case</span> BAUD128000:
00467                 TTY_WARNING(<span class="stringliteral">"Posix_QextSerialPort: POSIX does not support 128000 baud operation.  Switching to 115200 baud."</span>);
00468 <span class="preprocessor">#ifdef CBAUD</span>
00469 <span class="preprocessor"></span>                Posix_CommConfig.c_cflag&amp;=(~CBAUD);
00470                 Posix_CommConfig.c_cflag|=B115200;
00471 <span class="preprocessor">#else</span>
00472 <span class="preprocessor"></span>                cfsetispeed(&amp;Posix_CommConfig, B115200);
00473                 cfsetospeed(&amp;Posix_CommConfig, B115200);
00474 <span class="preprocessor">#endif</span>
00475 <span class="preprocessor"></span>                <span class="keywordflow">break</span>;
00476 
00477             <span class="comment">/*256000 baud*/</span>
00478             <span class="keywordflow">case</span> BAUD256000:
00479                 TTY_WARNING(<span class="stringliteral">"Posix_QextSerialPort: POSIX does not support 256000 baud operation.  Switching to 115200 baud."</span>);
00480 <span class="preprocessor">#ifdef CBAUD</span>
00481 <span class="preprocessor"></span>                Posix_CommConfig.c_cflag&amp;=(~CBAUD);
00482                 Posix_CommConfig.c_cflag|=B115200;
00483 <span class="preprocessor">#else</span>
00484 <span class="preprocessor"></span>                cfsetispeed(&amp;Posix_CommConfig, B115200);
00485                 cfsetospeed(&amp;Posix_CommConfig, B115200);
00486 <span class="preprocessor">#endif</span>
00487 <span class="preprocessor"></span>                <span class="keywordflow">break</span>;
00488         }
00489         tcsetattr(Posix_File-&gt;handle(), TCSAFLUSH, &amp;Posix_CommConfig);
00490     }
00491     UNLOCK_MUTEX();
00492 }
00493 
<a name="l00512"></a><a class="code" href="classPosix__QextSerialPort.html#a8">00512</a> <span class="keywordtype">void</span> <a class="code" href="classPosix__QextSerialPort.html#a8">Posix_QextSerialPort::setDataBits</a>(DataBitsType dataBits)
00513 {
00514     LOCK_MUTEX();
00515     <span class="keywordflow">if</span> (Settings.DataBits!=dataBits) {
00516         <span class="keywordflow">if</span> ((Settings.StopBits==STOP_2 &amp;&amp; dataBits==DATA_5) ||
00517             (Settings.StopBits==STOP_1_5 &amp;&amp; dataBits!=DATA_5) ||
00518             (Settings.Parity==PAR_SPACE &amp;&amp; dataBits==DATA_8)) {
00519         }
00520         <span class="keywordflow">else</span> {
00521             Settings.DataBits=dataBits;
00522         }
00523     }
00524     <span class="keywordflow">if</span> (portOpen) {
00525         <span class="keywordflow">switch</span>(dataBits) {
00526 
00527             <span class="comment">/*5 data bits*/</span>
00528             <span class="keywordflow">case</span> DATA_5:
00529                 <span class="keywordflow">if</span> (Settings.StopBits==STOP_2) {
00530                     TTY_WARNING(<span class="stringliteral">"Posix_QextSerialPort: 5 Data bits cannot be used with 2 stop bits."</span>);
00531                 }
00532                 <span class="keywordflow">else</span> {
00533                     Settings.DataBits=dataBits;
00534                     Posix_CommConfig.c_cflag&amp;=(~CSIZE);
00535                     Posix_CommConfig.c_cflag|=CS5;
00536                     tcsetattr(Posix_File-&gt;handle(), TCSAFLUSH, &amp;Posix_CommConfig);
00537                 }
00538                 <span class="keywordflow">break</span>;
00539 
00540             <span class="comment">/*6 data bits*/</span>
00541             <span class="keywordflow">case</span> DATA_6:
00542                 <span class="keywordflow">if</span> (Settings.StopBits==STOP_1_5) {
00543                     TTY_WARNING(<span class="stringliteral">"Posix_QextSerialPort: 6 Data bits cannot be used with 1.5 stop bits."</span>);
00544                 }
00545                 <span class="keywordflow">else</span> {
00546                     Settings.DataBits=dataBits;
00547                     Posix_CommConfig.c_cflag&amp;=(~CSIZE);
00548                     Posix_CommConfig.c_cflag|=CS6;
00549                     tcsetattr(Posix_File-&gt;handle(), TCSAFLUSH, &amp;Posix_CommConfig);
00550                 }
00551                 <span class="keywordflow">break</span>;
00552 
00553             <span class="comment">/*7 data bits*/</span>
00554             <span class="keywordflow">case</span> DATA_7:
00555                 <span class="keywordflow">if</span> (Settings.StopBits==STOP_1_5) {
00556                     TTY_WARNING(<span class="stringliteral">"Posix_QextSerialPort: 7 Data bits cannot be used with 1.5 stop bits."</span>);
00557                 }
00558                 <span class="keywordflow">else</span> {
00559                     Settings.DataBits=dataBits;
00560                     Posix_CommConfig.c_cflag&amp;=(~CSIZE);
00561                     Posix_CommConfig.c_cflag|=CS7;
00562                     tcsetattr(Posix_File-&gt;handle(), TCSAFLUSH, &amp;Posix_CommConfig);
00563                 }
00564                 <span class="keywordflow">break</span>;
00565 
00566             <span class="comment">/*8 data bits*/</span>
00567             <span class="keywordflow">case</span> DATA_8:
00568                 <span class="keywordflow">if</span> (Settings.StopBits==STOP_1_5) {
00569                     TTY_WARNING(<span class="stringliteral">"Posix_QextSerialPort: 8 Data bits cannot be used with 1.5 stop bits."</span>);
00570                 }
00571                 <span class="keywordflow">else</span> {
00572                     Settings.DataBits=dataBits;
00573                     Posix_CommConfig.c_cflag&amp;=(~CSIZE);
00574                     Posix_CommConfig.c_cflag|=CS8;
00575                     tcsetattr(Posix_File-&gt;handle(), TCSAFLUSH, &amp;Posix_CommConfig);
00576                 }
00577                 <span class="keywordflow">break</span>;
00578         }
00579     }
00580     UNLOCK_MUTEX();
00581 }
00582 
<a name="l00603"></a><a class="code" href="classPosix__QextSerialPort.html#a9">00603</a> <span class="keywordtype">void</span> <a class="code" href="classPosix__QextSerialPort.html#a9">Posix_QextSerialPort::setParity</a>(ParityType parity)
00604 {
00605     LOCK_MUTEX();
00606     <span class="keywordflow">if</span> (Settings.Parity!=parity) {
00607         <span class="keywordflow">if</span> (parity==PAR_MARK || (parity==PAR_SPACE &amp;&amp; Settings.DataBits==DATA_8)) {
00608         }
00609         <span class="keywordflow">else</span> {
00610             Settings.Parity=parity;
00611         }
00612     }
00613     <span class="keywordflow">if</span> (portOpen) {
00614         <span class="keywordflow">switch</span> (parity) {
00615 
00616             <span class="comment">/*space parity*/</span>
00617             <span class="keywordflow">case</span> PAR_SPACE:
00618                 <span class="keywordflow">if</span> (Settings.DataBits==DATA_8) {
00619                     TTY_PORTABILITY_WARNING(<span class="stringliteral">"Posix_QextSerialPort:  Space parity is only supported in POSIX with 7 or fewer data bits"</span>);
00620                 }
00621                 <span class="keywordflow">else</span> {
00622 
00623                     <span class="comment">/*space parity not directly supported - add an extra data bit to simulate it*/</span>
00624                     Posix_CommConfig.c_cflag&amp;=~(PARENB|CSIZE);
00625                     <span class="keywordflow">switch</span>(Settings.DataBits) {
00626                         <span class="keywordflow">case</span> DATA_5:
00627                             Settings.DataBits=DATA_6;
00628                             Posix_CommConfig.c_cflag|=CS6;
00629                             <span class="keywordflow">break</span>;
00630 
00631                         <span class="keywordflow">case</span> DATA_6:
00632                             Settings.DataBits=DATA_7;
00633                             Posix_CommConfig.c_cflag|=CS7;
00634                             <span class="keywordflow">break</span>;
00635 
00636                         <span class="keywordflow">case</span> DATA_7:
00637                             Settings.DataBits=DATA_8;
00638                             Posix_CommConfig.c_cflag|=CS8;
00639                             <span class="keywordflow">break</span>;
00640 
00641                         <span class="keywordflow">case</span> DATA_8:
00642                             <span class="keywordflow">break</span>;
00643                     }
00644                     tcsetattr(Posix_File-&gt;handle(), TCSAFLUSH, &amp;Posix_CommConfig);
00645                 }
00646                 <span class="keywordflow">break</span>;
00647 
00648             <span class="comment">/*mark parity - WINDOWS ONLY*/</span>
00649             <span class="keywordflow">case</span> PAR_MARK:
00650                 TTY_WARNING(<span class="stringliteral">"Posix_QextSerialPort: Mark parity is not supported by POSIX."</span>);
00651                 <span class="keywordflow">break</span>;
00652 
00653             <span class="comment">/*no parity*/</span>
00654             <span class="keywordflow">case</span> PAR_NONE:
00655                 Posix_CommConfig.c_cflag&amp;=(~PARENB);
00656                 tcsetattr(Posix_File-&gt;handle(), TCSAFLUSH, &amp;Posix_CommConfig);
00657                 <span class="keywordflow">break</span>;
00658 
00659             <span class="comment">/*even parity*/</span>
00660             <span class="keywordflow">case</span> PAR_EVEN:
00661                 Posix_CommConfig.c_cflag&amp;=(~PARODD);
00662                 Posix_CommConfig.c_cflag|=PARENB;
00663                 tcsetattr(Posix_File-&gt;handle(), TCSAFLUSH, &amp;Posix_CommConfig);
00664                 <span class="keywordflow">break</span>;
00665 
00666             <span class="comment">/*odd parity*/</span>
00667             <span class="keywordflow">case</span> PAR_ODD:
00668                 Posix_CommConfig.c_cflag|=(PARENB|PARODD);
00669                 tcsetattr(Posix_File-&gt;handle(), TCSAFLUSH, &amp;Posix_CommConfig);
00670                 <span class="keywordflow">break</span>;
00671         }
00672     }
00673     UNLOCK_MUTEX();
00674 }
00675 
<a name="l00692"></a><a class="code" href="classPosix__QextSerialPort.html#a10">00692</a> <span class="keywordtype">void</span> <a class="code" href="classPosix__QextSerialPort.html#a10">Posix_QextSerialPort::setStopBits</a>(StopBitsType stopBits)
00693 {
00694     LOCK_MUTEX();
00695     <span class="keywordflow">if</span> (Settings.StopBits!=stopBits) {
00696         <span class="keywordflow">if</span> ((Settings.DataBits==DATA_5 &amp;&amp; stopBits==STOP_2) || stopBits==STOP_1_5) {}
00697         <span class="keywordflow">else</span> {
00698             Settings.StopBits=stopBits;
00699         }
00700     }
00701     <span class="keywordflow">if</span> (portOpen) {
00702         <span class="keywordflow">switch</span> (stopBits) {
00703 
00704             <span class="comment">/*one stop bit*/</span>
00705             <span class="keywordflow">case</span> STOP_1:
00706                 Settings.StopBits=stopBits;
00707                 Posix_CommConfig.c_cflag&amp;=(~CSTOPB);
00708                 tcsetattr(Posix_File-&gt;handle(), TCSAFLUSH, &amp;Posix_CommConfig);
00709                 <span class="keywordflow">break</span>;
00710 
00711             <span class="comment">/*1.5 stop bits*/</span>
00712             <span class="keywordflow">case</span> STOP_1_5:
00713                 TTY_WARNING(<span class="stringliteral">"Posix_QextSerialPort: 1.5 stop bit operation is not supported by POSIX."</span>);
00714                 <span class="keywordflow">break</span>;
00715 
00716             <span class="comment">/*two stop bits*/</span>
00717             <span class="keywordflow">case</span> STOP_2:
00718                 <span class="keywordflow">if</span> (Settings.DataBits==DATA_5) {
00719                     TTY_WARNING(<span class="stringliteral">"Posix_QextSerialPort: 2 stop bits cannot be used with 5 data bits"</span>);
00720                 }
00721                 <span class="keywordflow">else</span> {
00722                     Settings.StopBits=stopBits;
00723                     Posix_CommConfig.c_cflag|=CSTOPB;
00724                     tcsetattr(Posix_File-&gt;handle(), TCSAFLUSH, &amp;Posix_CommConfig);
00725                 }
00726                 <span class="keywordflow">break</span>;
00727         }
00728     }
00729     UNLOCK_MUTEX();
00730 }
00731 
00745 <span class="keywordtype">void</span> Posix_QextSerialPort::setFlowControl(FlowType flow)
00746 {
00747     LOCK_MUTEX();
00748     <span class="keywordflow">if</span> (Settings.FlowControl!=flow) {
00749         Settings.FlowControl=flow;
00750     }
00751     <span class="keywordflow">if</span> (portOpen) {
00752         <span class="keywordflow">switch</span>(flow) {
00753 
00754             <span class="comment">/*no flow control*/</span>
00755             <span class="keywordflow">case</span> FLOW_OFF:
00756                 Posix_CommConfig.c_cflag&amp;=(~CRTSCTS);
00757                 Posix_CommConfig.c_iflag&amp;=(~(IXON|IXOFF|IXANY));
00758                 tcsetattr(Posix_File-&gt;handle(), TCSAFLUSH, &amp;Posix_CommConfig);
00759                 <span class="keywordflow">break</span>;
00760 
00761             <span class="comment">/*software (XON/XOFF) flow control*/</span>
00762             <span class="keywordflow">case</span> FLOW_XONXOFF:
00763                 Posix_CommConfig.c_cflag&amp;=(~CRTSCTS);
00764                 Posix_CommConfig.c_iflag|=(IXON|IXOFF|IXANY);
00765                 tcsetattr(Posix_File-&gt;handle(), TCSAFLUSH, &amp;Posix_CommConfig);
00766                 <span class="keywordflow">break</span>;
00767 
00768             <span class="keywordflow">case</span> FLOW_HARDWARE:
00769                 Posix_CommConfig.c_cflag|=CRTSCTS;
00770                 Posix_CommConfig.c_iflag&amp;=(~(IXON|IXOFF|IXANY));
00771                 tcsetattr(Posix_File-&gt;handle(), TCSAFLUSH, &amp;Posix_CommConfig);
00772                 <span class="keywordflow">break</span>;
00773         }
00774     }
00775     UNLOCK_MUTEX();
00776 }
00777 
00795 <span class="keywordtype">void</span> Posix_QextSerialPort::setTimeout(<span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> sec, <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> millisec)
00796 {
00797     LOCK_MUTEX();
00798     Settings.Timeout_Sec=sec;
00799     Settings.Timeout_Millisec=millisec;
00800     Posix_Copy_Timeout.tv_sec=sec;
00801     Posix_Copy_Timeout.tv_usec=millisec;
00802     <span class="keywordflow">if</span> (portOpen) {
00803         tcgetattr(Posix_File-&gt;handle(), &amp;Posix_CommConfig);
00804         Posix_CommConfig.c_cc[VTIME]=sec*10+millisec/100;
00805         tcsetattr(Posix_File-&gt;handle(), TCSAFLUSH, &amp;Posix_CommConfig);
00806     }
00807     UNLOCK_MUTEX();
00808 }
00809 
<a name="l00816"></a><a class="code" href="classPosix__QextSerialPort.html#a13">00816</a> <span class="keywordtype">bool</span> <a class="code" href="classPosix__QextSerialPort.html#a13">Posix_QextSerialPort::open</a>(OpenMode)
00817 {
00818     LOCK_MUTEX();
00819     <span class="keywordflow">if</span> (!portOpen) {
00820 
00821         <span class="comment">/*open the port*/</span>
00822         Posix_File-&gt;setFileName(port);
00823         <span class="keywordflow">if</span> (Posix_File-&gt;open(ReadWrite|Unbuffered)) {
00824             portOpen=<span class="keyword">true</span>;
00825 
00826             <span class="comment">/*configure port settings*/</span>
00827             tcgetattr(Posix_File-&gt;handle(), &amp;Posix_CommConfig);
00828 
00829             <span class="comment">/*set up other port settings*/</span>
00830             Posix_CommConfig.c_cflag|=CREAD|CLOCAL;
00831             Posix_CommConfig.c_lflag&amp;=(~(ICANON|ECHO|ECHOE|ECHOK|ECHONL|ISIG));
00832             Posix_CommConfig.c_iflag&amp;=(~(INPCK|IGNPAR|PARMRK|ISTRIP|ICRNL|IXANY));
00833             Posix_CommConfig.c_oflag&amp;=(~OPOST);
00834             Posix_CommConfig.c_cc[VMIN]=0;
00835             Posix_CommConfig.c_cc[VINTR] = _POSIX_VDISABLE;
00836             Posix_CommConfig.c_cc[VQUIT] = _POSIX_VDISABLE;
00837             Posix_CommConfig.c_cc[VSTART] = _POSIX_VDISABLE;
00838             Posix_CommConfig.c_cc[VSTOP] = _POSIX_VDISABLE;
00839             Posix_CommConfig.c_cc[VSUSP] = _POSIX_VDISABLE;
00840             <a class="code" href="classPosix__QextSerialPort.html#a7">setBaudRate</a>(Settings.BaudRate);
00841             <a class="code" href="classPosix__QextSerialPort.html#a8">setDataBits</a>(Settings.DataBits);
00842             <a class="code" href="classPosix__QextSerialPort.html#a9">setParity</a>(Settings.Parity);
00843             <a class="code" href="classPosix__QextSerialPort.html#a10">setStopBits</a>(Settings.StopBits);
00844             setFlowControl(Settings.FlowControl);
00845             setTimeout(Settings.Timeout_Sec, Settings.Timeout_Millisec);
00846             tcsetattr(Posix_File-&gt;handle(), TCSAFLUSH, &amp;Posix_CommConfig);
00847         }
00848     }
00849     UNLOCK_MUTEX();
00850     <span class="keywordflow">return</span> portOpen;
00851 }
00852 
<a name="l00858"></a><a class="code" href="classPosix__QextSerialPort.html#a14">00858</a> <span class="keywordtype">void</span> <a class="code" href="classPosix__QextSerialPort.html#a14">Posix_QextSerialPort::close</a>()
00859 {
00860     LOCK_MUTEX();
00861     Posix_File-&gt;close();
00862     portOpen=<span class="keyword">false</span>;
00863     UNLOCK_MUTEX();
00864 }
00865 
<a name="l00871"></a><a class="code" href="classPosix__QextSerialPort.html#a15">00871</a> <span class="keywordtype">void</span> <a class="code" href="classPosix__QextSerialPort.html#a15">Posix_QextSerialPort::flush</a>()
00872 {
00873     LOCK_MUTEX();
00874     <span class="keywordflow">if</span> (portOpen) {
00875         Posix_File-&gt;flush();
00876     }
00877     UNLOCK_MUTEX();
00878 }
00879 
<a name="l00887"></a><a class="code" href="classPosix__QextSerialPort.html#a16">00887</a> qint64 <a class="code" href="classPosix__QextSerialPort.html#a16">Posix_QextSerialPort::size</a>()<span class="keyword"> const</span>
00888 <span class="keyword"></span>{
00889     <span class="keywordtype">int</span> numBytes;
00890     <span class="keywordflow">if</span> (ioctl(Posix_File-&gt;handle(), FIONREAD, &amp;numBytes)&lt;0) {
00891         numBytes=0;
00892     }
00893     <span class="keywordflow">return</span> (qint64)numBytes;
00894 }
00895 
00902 qint64 Posix_QextSerialPort::bytesAvailable()
00903 {
00904     LOCK_MUTEX();
00905     <span class="keywordflow">if</span> (portOpen) {
00906         <span class="keywordtype">int</span> bytesQueued;
00907         fd_set fileSet;
00908         FD_ZERO(&amp;fileSet);
00909         FD_SET(Posix_File-&gt;handle(), &amp;fileSet);
00910 
00911         <span class="comment">/*on Linux systems the Posix_Timeout structure will be altered by the select() call.</span>
00912 <span class="comment">          Make sure we use the right timeout values*/</span>
00913         <span class="comment">//memcpy(&amp;Posix_Timeout, &amp;Posix_Copy_Timeout, sizeof(struct timeval));</span>
00914         Posix_Timeout = Posix_Copy_Timeout;
00915         <span class="keywordtype">int</span> n=select(Posix_File-&gt;handle()+1, &amp;fileSet, NULL, &amp;fileSet, &amp;Posix_Timeout);
00916         <span class="keywordflow">if</span> (!n) {
00917             lastErr=E_PORT_TIMEOUT;
00918             UNLOCK_MUTEX();
00919             <span class="keywordflow">return</span> -1;
00920         }
00921         <span class="keywordflow">if</span> (n==-1 || ioctl(Posix_File-&gt;handle(), FIONREAD, &amp;bytesQueued)==-1) {
00922             <a class="code" href="classPosix__QextSerialPort.html#a21">translateError</a>(errno);
00923             UNLOCK_MUTEX();
00924             <span class="keywordflow">return</span> -1;
00925         }
00926         lastErr=E_NO_ERROR;
00927         UNLOCK_MUTEX();
00928         <span class="keywordflow">return</span> bytesQueued;
00929     }
00930     UNLOCK_MUTEX();
00931     <span class="keywordflow">return</span> 0;
00932 }
00933 
<a name="l00939"></a><a class="code" href="classPosix__QextSerialPort.html#a18">00939</a> <span class="keywordtype">bool</span> <a class="code" href="classPosix__QextSerialPort.html#a18">Posix_QextSerialPort::getChar</a>(<span class="keywordtype">char</span> * c)
00940 {
00941     LOCK_MUTEX();
00942     <span class="keywordtype">bool</span> retVal=<span class="keyword">false</span>;
00943     <span class="keywordflow">if</span> (portOpen) {
00944         retVal = Posix_File-&gt;getChar(c);
00945         <span class="keywordflow">if</span>(retVal == <span class="keyword">false</span>) {
00946             lastErr=E_READ_FAILED;
00947         }
00948     }
00949     UNLOCK_MUTEX();
00950     <span class="keywordflow">return</span> retVal;
00951 }
00952 
<a name="l00959"></a><a class="code" href="classPosix__QextSerialPort.html#a19">00959</a> <span class="keywordtype">bool</span> <a class="code" href="classPosix__QextSerialPort.html#a19">Posix_QextSerialPort::putChar</a>(<span class="keywordtype">char</span> c)
00960 {
00961     LOCK_MUTEX();
00962     <span class="keywordtype">bool</span> retVal=<span class="keyword">false</span>;
00963     <span class="keywordflow">if</span> (portOpen) {
00964         retVal=Posix_File-&gt;putChar(c);
00965         <span class="keywordflow">if</span> (retVal == <span class="keyword">false</span>) {
00966             lastErr=E_WRITE_FAILED;
00967         }
00968     }
00969     UNLOCK_MUTEX();
00970     <a class="code" href="classPosix__QextSerialPort.html#a15">flush</a>();
00971     <span class="keywordflow">return</span> retVal;
00972 }
00973 
<a name="l00980"></a><a class="code" href="classPosix__QextSerialPort.html#a20">00980</a> <span class="keywordtype">void</span> <a class="code" href="classPosix__QextSerialPort.html#a20">Posix_QextSerialPort::ungetChar</a>(<span class="keywordtype">char</span>)
00981 {
00982 
00983     <span class="comment">/*meaningless on unbuffered sequential device - return error and print a warning*/</span>
00984     TTY_WARNING(<span class="stringliteral">"Posix_QextSerialPort: ungetChar() called on an unbuffered sequential device - operation is meaningless"</span>);
00985 }
00986 
<a name="l00991"></a><a class="code" href="classPosix__QextSerialPort.html#a21">00991</a> <span class="keywordtype">void</span> <a class="code" href="classPosix__QextSerialPort.html#a21">Posix_QextSerialPort::translateError</a>(ulong error)
00992 {
00993     <span class="keywordflow">switch</span> (error) {
00994         <span class="keywordflow">case</span> EBADF:
00995         <span class="keywordflow">case</span> ENOTTY:
00996             lastErr=E_INVALID_FD;
00997             <span class="keywordflow">break</span>;
00998 
00999         <span class="keywordflow">case</span> EINTR:
01000             lastErr=E_CAUGHT_NON_BLOCKED_SIGNAL;
01001             <span class="keywordflow">break</span>;
01002 
01003         <span class="keywordflow">case</span> ENOMEM:
01004             lastErr=E_NO_MEMORY;
01005             <span class="keywordflow">break</span>;
01006     }
01007 }
01008 
<a name="l01014"></a><a class="code" href="classPosix__QextSerialPort.html#a22">01014</a> <span class="keywordtype">void</span> <a class="code" href="classPosix__QextSerialPort.html#a22">Posix_QextSerialPort::setDtr</a>(<span class="keywordtype">bool</span> set)
01015 {
01016     LOCK_MUTEX();
01017     <span class="keywordflow">if</span> (portOpen) {
01018         <span class="keywordtype">int</span> status;
01019         ioctl(Posix_File-&gt;handle(), TIOCMGET, &amp;status);
01020         <span class="keywordflow">if</span> (set) {
01021             status|=TIOCM_DTR;
01022         }
01023         <span class="keywordflow">else</span> {
01024             status&amp;=~TIOCM_DTR;
01025         }
01026         ioctl(Posix_File-&gt;handle(), TIOCMSET, &amp;status);
01027     }
01028     UNLOCK_MUTEX();
01029 }
01030 
<a name="l01036"></a><a class="code" href="classPosix__QextSerialPort.html#a23">01036</a> <span class="keywordtype">void</span> <a class="code" href="classPosix__QextSerialPort.html#a23">Posix_QextSerialPort::setRts</a>(<span class="keywordtype">bool</span> set)
01037 {
01038     LOCK_MUTEX();
01039     <span class="keywordflow">if</span> (portOpen) {
01040         <span class="keywordtype">int</span> status;
01041         ioctl(Posix_File-&gt;handle(), TIOCMGET, &amp;status);
01042         <span class="keywordflow">if</span> (set) {
01043             status|=TIOCM_RTS;
01044         }
01045         <span class="keywordflow">else</span> {
01046             status&amp;=~TIOCM_RTS;
01047         }
01048         ioctl(Posix_File-&gt;handle(), TIOCMSET, &amp;status);
01049     }
01050     UNLOCK_MUTEX();
01051 }
01052 
<a name="l01076"></a><a class="code" href="classPosix__QextSerialPort.html#a24">01076</a> <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> <a class="code" href="classPosix__QextSerialPort.html#a24">Posix_QextSerialPort::lineStatus</a>()
01077 {
01078     <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> Status=0, Temp=0;
01079     LOCK_MUTEX();
01080     <span class="keywordflow">if</span> (portOpen) {
01081         ioctl(Posix_File-&gt;handle(), TIOCMGET, &amp;Temp);
01082         <span class="keywordflow">if</span> (Temp&amp;TIOCM_CTS) {
01083             Status|=LS_CTS;
01084         }
01085         <span class="keywordflow">if</span> (Temp&amp;TIOCM_DSR) {
01086             Status|=LS_DSR;
01087         }
01088         <span class="keywordflow">if</span> (Temp&amp;TIOCM_RI) {
01089             Status|=LS_RI;
01090         }
01091         <span class="keywordflow">if</span> (Temp&amp;TIOCM_CD) {
01092             Status|=LS_DCD;
01093         }
01094         <span class="keywordflow">if</span> (Temp&amp;TIOCM_DTR) {
01095             Status|=LS_DTR;
01096         }
01097         <span class="keywordflow">if</span> (Temp&amp;TIOCM_RTS) {
01098             Status|=LS_RTS;
01099         }
01100         <span class="keywordflow">if</span> (Temp&amp;TIOCM_ST) {
01101             Status|=LS_ST;
01102         }
01103         <span class="keywordflow">if</span> (Temp&amp;TIOCM_SR) {
01104             Status|=LS_SR;
01105         }
01106     }
01107     UNLOCK_MUTEX();
01108     <span class="keywordflow">return</span> Status;
01109 }
01110 
<a name="l01118"></a><a class="code" href="classPosix__QextSerialPort.html#a25">01118</a> qint64 <a class="code" href="classPosix__QextSerialPort.html#a25">Posix_QextSerialPort::readData</a>(<span class="keywordtype">char</span> * data, qint64 maxSize)
01119 {
01120     LOCK_MUTEX();
01121     <span class="keywordtype">int</span> retVal=0;
01122     <span class="keywordflow">if</span> (portOpen) {
01123         retVal=Posix_File-&gt;read(data, maxSize);
01124         <span class="keywordflow">if</span> (retVal==-1) {
01125             lastErr=E_READ_FAILED;
01126         }
01127     }
01128     UNLOCK_MUTEX();
01129     <span class="keywordflow">return</span> retVal;
01130 }
01131 
<a name="l01139"></a><a class="code" href="classPosix__QextSerialPort.html#a26">01139</a> qint64 <a class="code" href="classPosix__QextSerialPort.html#a26">Posix_QextSerialPort::writeData</a>(<span class="keyword">const</span> <span class="keywordtype">char</span> * data, qint64 maxSize)
01140 {
01141     LOCK_MUTEX();
01142     <span class="keywordtype">int</span> retVal=0;
01143     <span class="keywordflow">if</span> (portOpen) {
01144         retVal=Posix_File-&gt;write(data, maxSize);
01145         <span class="keywordflow">if</span> (retVal==-1) {
01146             lastErr=E_WRITE_FAILED;
01147         }
01148     }
01149     UNLOCK_MUTEX();
01150     <a class="code" href="classPosix__QextSerialPort.html#a15">flush</a>();
01151     <span class="keywordflow">return</span> retVal;
01152 }
</pre></div><hr size="1"><address style="align: right;"><small>Generated on Sat Jul 9 11:14:24 2005 for QextSerialPort by
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border=0 > </a>1.3.6 </small></address>
</body>
</html>
